<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neonix's Notes</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :root {
            --primary-blue: #007bff;
            --neon-glow: #00aaff;
            --bg-dark: #000814;
            --glass: rgba(0, 20, 50, 0.6);
            --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* Holiday Specific Transitions */
        body { transition: background-color 1s ease; }

        * { box-sizing: border-box; cursor: default; }
        
        body, html {
            margin: 0; padding: 0;
            height: 100vh; width: 100%;
            background: var(--bg-dark);
            font-family: 'Roboto', sans-serif;
            color: white;
            overflow: hidden;
        }

        /* --- SETTINGS BUTTON --- */
        #settings-button {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: var(--glass);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(0, 170, 255, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 2000;
            transition: var(--transition);
        }

        #settings-button:hover {
            transform: rotate(30deg) scale(1.1);
            border-color: var(--neon-glow);
            box-shadow: 0 0 20px rgba(0, 170, 255, 0.5);
        }

        #settings-button img {
            width: 24px;
            height: 24px;
            filter: drop-shadow(0 0 5px rgba(0, 170, 255, 0.5));
            transition: var(--transition);
        }

        #settings-button:hover img {
            filter: drop-shadow(0 0 10px var(--neon-glow));
        }

        /* --- SETTINGS PANEL --- */
        #settings-panel {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 320px;
            max-height: 80vh;
            background: rgba(0, 10, 30, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid var(--neon-glow);
            border-radius: 15px;
            padding: 20px;
            z-index: 1999;
            display: none;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.8);
            animation: slideDown 0.3s ease-out;
            overflow-y: auto;
        }

        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .settings-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 170, 255, 0.3);
        }

        .settings-header h3 {
            margin: 0;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--neon-glow);
        }

        .settings-category {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .settings-category:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .settings-category h4 {
            margin: 0 0 10px 0;
            font-size: 14px;
            color: var(--neon-glow);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .settings-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }

        .settings-option label {
            font-size: 13px;
            font-weight: bold;
            color: white;
            flex: 1;
        }

        .settings-option select,
        .settings-option input[type="text"] {
            background: rgba(0, 20, 50, 0.6);
            border: 1px solid var(--neon-glow);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 13px;
            outline: none;
            cursor: pointer;
            width: 150px;
            margin-left: 10px;
        }

        .settings-option input[type="text"] {
            cursor: text;
            padding: 6px 10px;
        }

        .settings-option input[type="range"] {
            width: 150px;
            margin-left: 10px;
            -webkit-appearance: none;
            height: 5px;
            background: rgba(0, 20, 50, 0.6);
            border-radius: 5px;
            outline: none;
        }

        .settings-option input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 15px;
            height: 15px;
            background: var(--neon-glow);
            border-radius: 50%;
            cursor: pointer;
        }

        .settings-option select option {
            background: #000814;
        }

        .settings-button {
            background: var(--primary-blue);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 5px;
            width: 100%;
        }

        .settings-button:hover {
            background: #0056b3;
            box-shadow: 0 0 10px rgba(0, 170, 255, 0.5);
        }

        .settings-button.secondary {
            background: rgba(0, 170, 255, 0.2);
            margin-top: 10px;
        }

        .settings-button.secondary:hover {
            background: rgba(0, 170, 255, 0.4);
        }

        .color-preview {
            width: 30px;
            height: 30px;
            border-radius: 5px;
            border: 2px solid var(--neon-glow);
            cursor: pointer;
            margin-left: 10px;
        }

        .settings-info {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 5px;
            font-style: italic;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
            margin-left: 10px;
        }

        .toggle-switch input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            margin: 0;
            padding: 0;
            cursor: pointer;
        }

        .toggle-slider {
            position: absolute;
            display: block;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 20, 50, 0.6);
            border: 1px solid var(--neon-glow);
            border-radius: 34px;
            transition: .4s;
            pointer-events: none;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            border-radius: 50%;
            transition: .4s;
        }

        input:checked + .toggle-slider {
            background-color: var(--neon-glow);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        /* --- ANNOUNCEMENT BUBBLE --- */
        #holiday-bubble {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--glass);
            backdrop-filter: blur(10px);
            border: 2px solid var(--neon-glow);
            padding: 15px 25px;
            border-radius: 50px;
            z-index: 2000;
            display: none;
            align-items: center;
            gap: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            animation: slideUp 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 14px;
        }

        @keyframes slideUp {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* --- LOADING SCREEN --- */
        #loading-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-dark);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.8s ease, visibility 0.8s;
        }

        .loader-logo {
            width: 80px;
            height: 80px;
            margin-bottom: 25px;
            filter: drop-shadow(0 0 15px var(--neon-glow));
            animation: pulse 2s infinite ease-in-out;
        }

        .loader-bar-container {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .loader-bar-fill {
            position: absolute;
            top: 0; left: 0; height: 100%;
            width: 0%;
            background: var(--neon-glow);
            box-shadow: 0 0 10px var(--neon-glow);
            transition: width 0.4s ease;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; }
        }

        /* --- NAVIGATION UI --- */
        .top-nav {
            position: fixed;
            top: 0; left: 0; right: 0;
            height: 85px;
            background: var(--glass);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-bottom: 2px solid rgba(0, 170, 255, 0.2);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: var(--transition);
            opacity: 0.6;
            position: relative;
            text-decoration: none;
            color: inherit;
        }

        .nav-item:hover, .nav-item.active {
            opacity: 1;
            transform: translateY(-3px);
        }

        .folder-item { cursor: default; }
        .folder-item:hover .dropdown-menu { 
            visibility: visible; 
            opacity: 1; 
            transform: translateX(-50%) translateY(0); 
        }

        .nav-item img {
            width: 32px;
            height: 32px;
            object-fit: contain;
            filter: drop-shadow(0 0 8px rgba(0, 170, 255, 0.5));
            margin-bottom: 5px;
        }

        .folder-icon { filter: drop-shadow(0 0 5px var(--neon-glow)); }

        .nav-label {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 10px;
            text-transform: uppercase;
            font-weight: 900;
            letter-spacing: 1px;
            text-align: center;
            white-space: nowrap;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(10px);
            background: rgba(0, 10, 30, 0.95);
            border: 1px solid var(--neon-glow);
            border-radius: 12px;
            padding: 10px;
            min-width: 220px;
            visibility: hidden;
            opacity: 0;
            transition: var(--transition);
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
            margin-top: 10px;
            max-height: 400px;
            overflow-y: auto;
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            border-radius: 8px;
            transition: 0.2s;
            cursor: pointer;
        }

        .dropdown-item:hover { background: rgba(0, 170, 255, 0.2); }
        .dropdown-item img { width: 24px !important; height: 24px !important; margin: 0 !important; }
        .dropdown-item span { font-size: 12px; font-weight: bold; color: white; white-space: nowrap; }

        /* --- SECTIONS --- */
        .page-section {
            position: absolute;
            top: 85px; left: 0;
            width: 100%;
            height: calc(100vh - 85px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2;
        }
        .page-section.active { display: flex; }

        canvas#canvas-webgl { 
            position: fixed; 
            top: 0; 
            left: 0; 
            z-index: 0; 
            width: 100%; 
            height: 100%;
            opacity: 1;
            transition: opacity 1s ease;
        }

        canvas#particles-canvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 0;
            width: 100%;
            height: 100%;
            display: none;
            opacity: 0;
            transition: opacity 1s ease;
        }

        #static-bg {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #000814 0%, #001428 50%, #000a14 100%);
            display: none;
            opacity: 0;
            transition: opacity 1s ease;
        }

        /* --- CONTENT STYLES --- */
        .main-container { width: 90%; max-width: 650px; text-align: center; z-index: 5; }
        h1 { font-size: clamp(26px, 6.5vw, 65px); font-weight: 800; margin-bottom: 25px; }
        
        /* --- INFO WIDGET (Date & Weather) --- */
        .info-widget {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 900;
            color: var(--neon-glow);
            opacity: 0.9;
        }
        .info-widget div {
            padding: 5px 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            border: 1px solid rgba(0, 170, 255, 0.1);
        }

        .search-wrapper { 
            position: relative; background: var(--glass); border: 2px solid rgba(0, 123, 255, 0.3); 
            border-radius: 50px; padding: 10px 25px; display: flex; align-items: center; 
            transition: var(--transition); box-shadow: 0 10px 30px rgba(0,0,0,0.5); overflow: hidden; 
        }
        input { flex: 1; background: transparent; border: none; color: white; font-size: 18px; padding: 10px; outline: none; cursor: text; }

        .btn-group { display: flex; gap: 15px; margin-top: 30px; }
        .curved-btn { 
            flex: 1; padding: 18px; background: var(--primary-blue); color: white; 
            border: none; border-radius: 50px; font-weight: bold; text-transform: uppercase; 
            cursor: pointer; text-decoration: none; transition: var(--transition); font-size: 12px; text-align: center;
        }
        .curved-btn:hover { background: #0056b3; box-shadow: 0 8px 25px rgba(0, 123, 255, 0.5); transform: translateY(-3px); }

        .partner-container { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; }
        .partner-card { 
            display: flex; flex-direction: column; align-items: center; text-decoration: none; 
            color: white; transition: var(--transition); background: rgba(0, 20, 50, 0.4);
            padding: 20px; border-radius: 20px; border: 1px solid rgba(0, 170, 255, 0.2); backdrop-filter: blur(5px);
            width: 220px;
        }
        .partner-card img { width: 100%; border-radius: 10px; margin-bottom: 15px; }

        @keyframes flicker {
            0%, 18%, 22%, 25%, 53%, 57%, 100% { 
                text-shadow: 0 0 7px #fff, 0 0 10px #fff, 0 0 21px var(--neon-glow), 0 0 42px var(--primary-blue); 
            }
            20%, 24%, 55% { text-shadow: none; }
        }
        .neon-title {
            font-size: clamp(40px, 8vw, 80px);
            font-weight: 900;
            animation: flicker 4s infinite alternate;
            text-transform: uppercase;
            margin-bottom: 40px;
        }

        .scan-line { position: absolute; top: 0; left: -100%; width: 50%; height: 100%; background: linear-gradient(90deg, transparent, rgba(0, 170, 255, 0.4), transparent); }
        .searching .scan-line { animation: scan 1.5s infinite linear; }
        @keyframes scan { 0% { left: -100%; } 100% { left: 200%; } }

        /* --- TAB CLOAKER PREVIEW --- */
        #cloak-preview {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid var(--neon-glow);
            border-radius: 10px;
            padding: 10px;
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 10px;
            backdrop-filter: blur(10px);
            transition: var(--transition);
        }

        #cloak-preview img {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        #cloak-preview span {
            font-size: 12px;
            font-weight: bold;
            color: white;
        }

        #cloak-preview:hover {
            background: rgba(0, 0, 0, 0.9);
            transform: scale(1.05);
        }

        /* --- ANNOUNCEMENT --- */
        #announcement {
            position: fixed;
            top: 20%;
            left: 50%;
            transform: translateX(-50%) translateY(-20px) scale(0.98);
            background: linear-gradient(180deg, rgba(0,0,0,0.9), rgba(0,0,0,0.85));
            border: 2px solid var(--neon-glow);
            color: #fff;
            padding: 18px 20px;
            border-radius: 12px;
            z-index: 3000;
            min-width: 320px;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.7);
            transition: transform 0.35s ease, opacity 0.35s ease;
        }
        #announcement.visible { display:flex; transform: translateX(-50%) translateY(0) scale(1); }
        #announcement .announcement-content { text-align: center; width: 100%; }
        #announcement h2 { margin: 0 0 8px 0; font-size: 18px; color: var(--neon-glow); }
        #announcement p { margin: 0 0 12px 0; font-size: 13px; color: rgba(255,255,255,0.9); }
        #announcement .announcement-close {
            position: absolute; top: 8px; right: 10px; background: transparent; border: none; color: #fff; font-size: 14px; cursor: pointer;
        }
        #announcement .claim-btn { margin-top: 6px; }

        /* --- PROFILE (bottom center) --- */
        #profile-button {
            position: fixed;
            bottom: 18px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 3001;
            cursor: pointer;
        }
        #profile-button img { width: 48px; height: 48px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.08); box-shadow: 0 6px 20px rgba(0,0,0,0.6); }

        #profile-panel {
            position: fixed;
            bottom: 78px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 3002;
            min-width: 320px;
            background: rgba(0, 8, 20, 0.95);
            border: 1px solid var(--neon-glow);
            padding: 14px;
            border-radius: 12px;
            display: none;
            box-shadow: 0 20px 60px rgba(0,0,0,0.7);
        }
        #profile-panel.visible { display:block; }
        #profile-panel .row { display:flex; gap:10px; align-items:center; margin-bottom:8px; }
        #profile-panel input[type="text"] { flex:1; background: rgba(0,20,50,0.6); border:1px solid var(--neon-glow); color:#fff; padding:6px 8px; border-radius:6px; }
        #profile-panel .small { font-size:12px; color:rgba(255,255,255,0.7); }
        #profile-panel .panel-actions { display:flex; gap:8px; justify-content:center; margin-top:8px; }
    </style>
</head>
<body>

    <!-- TAB CLOAKER PREVIEW -->
    <div id="cloak-preview" style="display: none;">
        <img id="cloak-icon" src="" alt="Cloaked Tab Icon">
        <span id="cloak-title">Loading...</span>
    </div>

    <!-- SETTINGS BUTTON -->
    <div id="settings-button">
        <img src="https://cdn.jsdelivr.net/gh/gn-math/gn-math-DONTDMCA@main/setting.png" alt="Settings">
    </div>

    <!-- SETTINGS PANEL -->
    <div id="settings-panel">
        <div class="settings-header">
            <img src="https://cdn.jsdelivr.net/gh/gn-math/gn-math-DONTDMCA@main/setting.png" alt="Settings" width="20" height="20">
            <h3>Settings</h3>
        </div>
        
        <!-- THEME SECTION -->
        <div class="settings-category">
            <h4>Theme & Appearance</h4>
            <div class="settings-option">
                <label for="theme-select">Theme</label>
                <select id="theme-select">
                    <option value="default">Default Theme</option>
                    <option value="dark">Dark Mode</option>
                    <option value="light">Light Mode</option>
                    <option value="ocean">Ocean Blue</option>
                    <option value="neon">Neon Purple</option>
                    <option value="custom">Custom Colors</option>
                </select>
            </div>
            <div class="settings-option" id="custom-colors" style="display: none;">
                <label>Primary Color</label>
                <input type="color" id="primary-color-picker" value="#007bff" style="width: 40px; height: 30px;">
            </div>
        </div>

        <!-- ANIMATIONS SECTION -->
        <div class="settings-category">
            <h4>Animations</h4>
            <div class="settings-option">
                <label for="animations-select">Animation Level</label>
                <select id="animations-select">
                    <option value="full">Full Animations</option>
                    <option value="reduced">Reduced Motion</option>
                    <option value="none">No Animations</option>
                </select>
            </div>
            <div class="settings-option">
                <label for="bg-animation-speed">BG Animation Speed</label>
                <input type="range" id="bg-animation-speed" min="0.1" max="3" step="0.1" value="1">
            </div>
            <div class="settings-option">
                <label for="enable-holiday">Holiday Themes</label>
                <div class="toggle-switch">
                    <input type="checkbox" id="enable-holiday" checked>
                    <span class="toggle-slider"></span>
                </div>
            </div>
        </div>

        <!-- BACKGROUND SECTION -->
        <div class="settings-category">
            <h4>Background</h4>
            <div class="settings-option">
                <label for="background-select">Background Type</label>
                <select id="background-select">
                    <option value="waves">Animated Waves</option>
                    <option value="particles">Particle System</option>
                    <option value="static">Static Gradient</option>
                    <option value="custom">Custom Image</option>
                    <option value="none">No Background</option>
                </select>
            </div>
            <div class="settings-option" id="custom-bg-url" style="display: none;">
                <label for="bg-image-url">Image URL</label>
                <input type="text" id="bg-image-url" placeholder="https://example.com/image.jpg">
            </div>
            <div class="settings-option" id="bg-opacity-control">
                <label for="bg-opacity">Background Opacity</label>
                <input type="range" id="bg-opacity" min="0.1" max="1" step="0.1" value="1">
            </div>
            <button class="settings-button secondary" id="apply-bg">Apply Background Changes</button>
        </div>

        <!-- TAB CLOAKER SECTION -->
        <div class="settings-category">
            <h4>Tab Cloaker</h4>
            <div class="settings-option">
                <label for="cloak-title-input">Tab Title</label>
                <input type="text" id="cloak-title-input" placeholder="Google Classroom">
            </div>
            <div class="settings-option">
                <label for="cloak-icon-url">Icon URL</label>
                <input type="text" id="cloak-icon-url" placeholder="https://example.com/icon.png">
            </div>
            <div class="settings-option">
                <label>Enable Cloaking</label>
                <div class="toggle-switch">
                    <input type="checkbox" id="enable-cloak">
                    <span class="toggle-slider"></span>
                </div>
            </div>
            <button class="settings-button" id="apply-cloak">Apply Tab Cloak</button>
            <button class="settings-button secondary" id="reset-cloak">Reset to Default</button>
        </div>

        <!-- WEATHER SECTION -->
        <div class="settings-category">
            <h4>Weather</h4>
            <div class="settings-option">
                <label for="weather-unit">Temperature Unit</label>
                <select id="weather-unit">
                    <option value="fahrenheit">Â°F Fahrenheit</option>
                    <option value="celsius">Â°C Celsius</option>
                </select>
            </div>
            <div class="settings-option">
                <label for="weather-location">Custom Location</label>
                <input type="text" id="weather-location" placeholder="Berlin, Germany">
            </div>
        </div>

        <!-- RESET SECTION -->
        <div class="settings-category">
            <h4>Reset & Save</h4>
            <button class="settings-button" id="save-settings">Save All Settings</button>
            <button class="settings-button secondary" id="reset-settings">Reset to Default</button>
            <p class="settings-info">Settings are automatically saved to your browser's local storage.</p>
        </div>
    </div>

    <!-- BACKGROUND CANVASES -->
    <canvas id="canvas-webgl"></canvas>
    <canvas id="particles-canvas"></canvas>
    <div id="static-bg"></div>

    <!-- LOADING SCREEN -->
    <div id="loading-screen">
        <img src="https://gcdnb.pbrd.co/images/2tAx6LlPWqWu.png?o=1" class="loader-logo" alt="Loading...">
        <div class="loader-bar-container">
            <div class="loader-bar-fill" id="loader-bar"></div>
        </div>
    </div>

    <!-- HOLIDAY ANNOUNCEMENT BUBBLE -->
    <div id="holiday-bubble">
        <span id="holiday-emoji">ðŸŽ‰</span>
        <span id="holiday-text">Happy Day!</span>
    </div>

    <!-- SITE ANNOUNCEMENT -->
    <div id="announcement" role="dialog" aria-modal="true" aria-labelledby="announcement-title">
        <div class="announcement-content">
            <button class="announcement-close" aria-label="Close announcement" onclick="closeAnnouncement()">âœ•</button>
            <h2 id="announcement-title">V1 IS HERE!!!</h2>
            <p>Thanks for being part of the journey â€” claim your OG spot now.</p>
            <button id="claim-og-btn" class="settings-button claim-btn">claim ur og spot</button>
        </div>
    </div>

    <!-- PROFILE BUTTON + PANEL -->
    <div id="profile-button" title="Profile settings">
        <img id="profile-avatar" src="https://static.vecteezy.com/system/resources/thumbnails/009/292/244/small/default-avatar-icon-of-social-media-user-vector.jpg" alt="Profile">
    </div>

    <div id="profile-panel" role="dialog" aria-label="Profile settings">
        <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px;">
            <img id="panel-avatar-preview" src="https://static.vecteezy.com/system/resources/thumbnails/009/292/244/small/default-avatar-icon-of-social-media-user-vector.jpg" alt="Avatar" style="width:56px;height:56px;border-radius:50%;border:1px solid rgba(255,255,255,0.06)">
            <div style="flex:1">
                <div class="small">Signed in as</div>
                <div id="panel-username" style="font-weight:900">Guest</div>
            </div>
        </div>

        <div class="row">
            <div id="gsi-button"></div>
            <button id="google-signin" class="settings-button" style="display:none;">Sign in (fallback)</button>
            <button id="signout-btn" class="settings-button secondary">Sign out</button>
        </div>

        <div class="row">
            <input type="text" id="username-input" placeholder="Choose a username">
        </div>
        <div class="small" id="username-info">You can change your username once every 7 days.</div>

        <div style="margin-top:8px">
            <label class="small">Avatar (upload)</label>
            <input type="file" id="avatar-file" accept="image/*">
        </div>
        <div style="margin-top:8px">
            <label class="small">Or avatar URL</label>
            <input type="text" id="avatar-url" placeholder="https://example.com/avatar.png">
        </div>

        <div class="panel-actions">
            <button id="save-profile" class="settings-button">Save</button>
            <button id="close-profile" class="settings-button secondary">Close</button>
        </div>
    </div>

    <nav class="top-nav">
        <div class="nav-item active" onclick="showSection('notes', this)">
            <img src="https://gcdnb.pbrd.co/images/2tAx6LlPWqWu.png?o=1" alt="Home">
            <div class="nav-label">Home</div>
        </div>
        
        <div class="nav-item" onclick="openGames(this)">
            <img src="https://gcdnb.pbrd.co/images/64YwQJN3Mlw0.png?o=1" alt="Games">
            <div class="nav-label">Games</div>
        </div>
        
        <div class="nav-item folder-item">
            <img src="https://gcdnb.pbrd.co/images/klrIPWiuxLFX.png?o=1" class="folder-icon" alt="Folder">
            <div class="nav-label">About:Blank <span style="font-size:14px">âŒµ</span></div>
            <div class="dropdown-menu">
                <div class="dropdown-item" onclick="openLauncher('Pizza Edition', 'https://pizzaedition.win//')">
                    <img src="https://gcdnb.pbrd.co/images/LcQ01msjLL0e.png?o=1" alt="Pizza">
                    <span>Pizza Edition</span>
                </div>
                <div class="dropdown-item" onclick="openLauncher('Velara', 'https://ilovelittlekids.buzz//')">
                    <img src="https://gcdnb.pbrd.co/images/Q8j4sAZ0DY7A.png?o=1" alt="Velara">
                    <span>Velara</span>
                </div>
                <div class="dropdown-item" onclick="openLauncher('Geometry Learn V4', 'https://dsv.135.148.27.57.nip.io/')">
                    <img src="https://dsv.135.148.27.57.nip.io/assets/img/essential/icon.ico" alt="Geometry">
                    <span>Geometry Learn V4</span>
                </div>
                <div class="dropdown-item" onclick="openLauncher('Glacier Arcade', 'https://glacierarcade.win//')">
                    <img src="https://gcdnb.pbrd.co/images/Z2LvYGxXn3GT.png?o=1" alt="Glacier">
                    <span>Glacier Arcade</span>
                </div>
                <div class="dropdown-item" onclick="openLauncher('Hypackel Games', 'https://hypackel.games//')">
                    <img src="https://gcdnb.pbrd.co/images/93ACdqHChBVP.png?o=1" alt="Hypackel">
                    <span>Hypackel Games</span>
                </div>
                <div class="dropdown-item" onclick="openLauncher('SZ Games', 'https://sz-games.github.io//')">
                    <img src="https://raw.githubusercontent.com/sz-games/home/refs/heads/main/G.png" alt="SZ">
                    <span>SZ Games</span>
                </div>
                <div class="dropdown-item" onclick="openLauncher('Gn-Math', 'https://www.gn-math.dev/')">
                    <img src="https://cdn.jsdelivr.net/gh/gn-math/gn-math-DONTDMCA@main/favicon.png" alt="Gn-Math">
                    <span>Gn-Math</span>
                </div>
            </div>
        </div>

        <div class="nav-item" onclick="showSection('partners', this)">
            <img src="https://gcdnb.pbrd.co/images/dFyzmCOjPDNP.png?o=1" alt="Partners">
            <div class="nav-label">Partners</div>
        </div>

        <a href="https://docs.google.com/forms/d/e/1FAIpQLSdsz5eGGtmTyAoHOvCw3vRMVpgMwjfUOILBifaXF9mI1l22ww/viewform" target="_blank" class="nav-item">
            <img src="https://gcdnb.pbrd.co/images/j3ngnwYLdI8u.png?o=1" alt="Submission">
            <div class="nav-label">Gxme Submission</div>
        </a>
    </nav>

    <!-- SECTIONS -->
    <section id="notes" class="page-section active">
        <div class="main-container">
            <!-- DATE AND WEATHER WIDGET -->
            <div class="info-widget">
                <div id="current-date">Loading...</div>
                <div id="current-weather">Updating...</div>
            </div>

            <h1>Neonix's Notes .</h1>
            <div class="search-wrapper" id="searchBox">
                <div class="scan-line"></div>
                <input type="text" id="searchInput" placeholder="Search the notes..." autocomplete="off">
            </div>
            <div class="btn-group">
                <a href="https://sites.google.com/view/stealschools/form" target="_blank" class="curved-btn">Request Notes</a>
                <a href="https://discord.gg/yJfPuDdK2e" target="_blank" class="curved-btn">Join Discord</a>
            </div>
        </div>
    </section>

    <section id="launcher-page" class="page-section">
        <div class="main-container">
            <h1 class="neon-title" id="launcher-title">Launcher</h1>
            <button class="curved-btn" style="padding: 20px 50px; font-size: 18px;" id="launcher-btn">Open in about:blank</button>
        </div>
    </section>

    <section id="games" class="page-section">
        <iframe id="games-frame" src="" style="width:100%; height:100%; border:none;" title="Games"></iframe>
    </section>

    <section id="partners" class="page-section">
        <div style="text-align:center;">
            <h1 style="margin-bottom: 40px;">Partners</h1>
            <div class="partner-container">
                <a href="https://sites.google.com/stu.warren.kyschools.us/pumpkinguygames/home?authuser=0" target="_blank" class="partner-card">
                    <img src="https://pbs.twimg.com/media/GY0nCy5WkAA9VbZ.png" alt="Pumpkin">
                    <p>Pumpkin Guy Games</p>
                </a>
                <a href="https://sites.google.com/ahschools.us/free-math-gamess" target="_blank" class="partner-card">
                    <img src="https://gcdnb.pbrd.co/images/JRMIvVHodd0y.jpg?o=1" alt="Math">
                    <p>Unblocked Games</p>
                </a>
            </div>
        </div>
    </section>

    <script>
        // ========================
        // SETTINGS SYSTEM
        // ========================
        let settingsVisible = false;
        let currentBackground = 'waves';
        let particleSystemActive = false;
        let particles = [];
        let particlesCanvas, particlesCtx;

        // Initialize settings from localStorage
        const defaultSettings = {
            theme: 'default',
            animations: 'full',
            background: 'waves',
            weatherUnit: 'fahrenheit',
            holidayThemes: true,
            bgAnimationSpeed: 1,
            bgOpacity: 1,
            cloakEnabled: false,
            cloakTitle: 'Neonix\'s Notes',
            cloakIcon: 'https://gcdnb.pbrd.co/images/2tAx6LlPWqWu.png?o=1'
        };

        let settings = JSON.parse(localStorage.getItem('neonix-settings')) || defaultSettings;

        // ========================
        // SETTINGS UI CONTROL
        // ========================
        const settingsButton = document.getElementById('settings-button');
        const settingsPanel = document.getElementById('settings-panel');

        settingsButton.addEventListener('click', (e) => {
            e.stopPropagation();
            settingsVisible = !settingsVisible;
            settingsPanel.style.display = settingsVisible ? 'block' : 'none';
        });

        document.addEventListener('click', () => {
            if (settingsVisible) {
                settingsVisible = false;
                settingsPanel.style.display = 'none';
            }
        });

        settingsPanel.addEventListener('click', (e) => {
            e.stopPropagation();
        });

        // ========================
        // THEME SYSTEM
        // ========================
        function applyTheme(theme) {
            const root = document.documentElement;
            
            switch(theme) {
                case 'dark':
                    root.style.setProperty('--primary-blue', '#0056b3');
                    root.style.setProperty('--neon-glow', '#0077cc');
                    root.style.setProperty('--bg-dark', '#000000');
                    root.style.setProperty('--glass', 'rgba(0, 0, 0, 0.8)');
                    break;
                case 'light':
                    root.style.setProperty('--primary-blue', '#007bff');
                    root.style.setProperty('--neon-glow', '#00aaff');
                    root.style.setProperty('--bg-dark', '#f0f0f0');
                    root.style.setProperty('--glass', 'rgba(240, 240, 240, 0.8)');
                    break;
                case 'ocean':
                    root.style.setProperty('--primary-blue', '#1e90ff');
                    root.style.setProperty('--neon-glow', '#00ced1');
                    root.style.setProperty('--bg-dark', '#001f3f');
                    root.style.setProperty('--glass', 'rgba(0, 31, 63, 0.8)');
                    break;
                case 'neon':
                    root.style.setProperty('--primary-blue', '#9d00ff');
                    root.style.setProperty('--neon-glow', '#ff00ff');
                    root.style.setProperty('--bg-dark', '#0a0014');
                    root.style.setProperty('--glass', 'rgba(10, 0, 20, 0.8)');
                    break;
                case 'custom':
                    // Custom colors handled by color picker
                    break;
                default:
                    root.style.setProperty('--primary-blue', '#007bff');
                    root.style.setProperty('--neon-glow', '#00aaff');
                    root.style.setProperty('--bg-dark', '#000814');
                    root.style.setProperty('--glass', 'rgba(0, 20, 50, 0.6)');
            }
        }

        // ========================
        // ANIMATION SYSTEM
        // ========================
        function applyAnimations(level) {
            const allElements = document.querySelectorAll('*');
            
            if (level === 'none') {
                allElements.forEach(el => {
                    el.style.animationPlayState = 'paused';
                    el.style.transition = 'none';
                });
                plane.speed = 0;
            } else if (level === 'reduced') {
                allElements.forEach(el => {
                    if (el.style.animationDuration) {
                        el.style.animationDuration = '0.5s';
                    }
                    if (el.style.transitionDuration) {
                        el.style.transitionDuration = '0.3s';
                    }
                });
                plane.speed = 0.5;
            } else {
                allElements.forEach(el => {
                    el.style.animationPlayState = 'running';
                    el.style.transition = '';
                });
                plane.speed = settings.bgAnimationSpeed || 1;
            }
        }

        // ========================
        // BACKGROUND SYSTEM
        // ========================
        function initParticles() {
            particlesCanvas = document.getElementById('particles-canvas');
            particlesCtx = particlesCanvas.getContext('2d');
            particlesCanvas.width = window.innerWidth;
            particlesCanvas.height = window.innerHeight;
            particles = [];
            
            // Create particles
            for (let i = 0; i < 100; i++) {
                particles.push({
                    x: Math.random() * particlesCanvas.width,
                    y: Math.random() * particlesCanvas.height,
                    size: Math.random() * 3 + 1,
                    speedX: Math.random() * 2 - 1,
                    speedY: Math.random() * 2 - 1,
                    color: `rgba(0, 170, 255, ${Math.random() * 0.5 + 0.2})`
                });
            }
        }

        function animateParticles() {
            if (!particleSystemActive) return;
            
            particlesCtx.clearRect(0, 0, particlesCanvas.width, particlesCanvas.height);
            
            for (let particle of particles) {
                particle.x += particle.speedX;
                particle.y += particle.speedY;
                
                // Bounce off edges
                if (particle.x < 0 || particle.x > particlesCanvas.width) particle.speedX *= -1;
                if (particle.y < 0 || particle.y > particlesCanvas.height) particle.speedY *= -1;
                
                // Draw particle
                particlesCtx.beginPath();
                particlesCtx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                particlesCtx.fillStyle = particle.color;
                particlesCtx.fill();
            }
            
            requestAnimationFrame(animateParticles);
        }

        function switchBackground(type) {
            const webglCanvas = document.getElementById('canvas-webgl');
            const particlesCanvas = document.getElementById('particles-canvas');
            const staticBg = document.getElementById('static-bg');
            const customBgUrl = document.getElementById('bg-image-url').value;
            
            // Hide all backgrounds first
            webglCanvas.style.opacity = '0';
            particlesCanvas.style.opacity = '0';
            staticBg.style.opacity = '0';
            
            setTimeout(() => {
                webglCanvas.style.display = 'none';
                particlesCanvas.style.display = 'none';
                staticBg.style.display = 'none';
                
                switch(type) {
                    case 'waves':
                        webglCanvas.style.display = 'block';
                        setTimeout(() => webglCanvas.style.opacity = settings.bgOpacity || '1', 50);
                        particleSystemActive = false;
                        break;
                    case 'particles':
                        particlesCanvas.style.display = 'block';
                        setTimeout(() => particlesCanvas.style.opacity = settings.bgOpacity || '1', 50);
                        particleSystemActive = true;
                        initParticles();
                        animateParticles();
                        break;
                    case 'static':
                        staticBg.style.display = 'block';
                        setTimeout(() => staticBg.style.opacity = settings.bgOpacity || '1', 50);
                        particleSystemActive = false;
                        break;
                    case 'custom':
                        if (customBgUrl) {
                            document.body.style.backgroundImage = `url('${customBgUrl}')`;
                            document.body.style.backgroundSize = 'cover';
                            document.body.style.backgroundPosition = 'center';
                            document.body.style.backgroundRepeat = 'no-repeat';
                        }
                        particleSystemActive = false;
                        break;
                    case 'none':
                        document.body.style.backgroundImage = 'none';
                        particleSystemActive = false;
                        break;
                }
            }, 300);
        }

        // ========================
        // TAB CLOAKER SYSTEM
        // ========================
        function applyTabCloak(title, iconUrl) {
            const preview = document.getElementById('cloak-preview');
            const previewIcon = document.getElementById('cloak-icon');
            const previewTitle = document.getElementById('cloak-title');
            
            if (settings.cloakEnabled && title && iconUrl) {
                // Change tab title
                document.title = title;
                
                // Update preview
                previewIcon.src = iconUrl;
                previewTitle.textContent = title;
                preview.style.display = 'flex';
                
                // Update favicon
                const link = document.querySelector("link[rel*='icon']") || document.createElement('link');
                link.type = 'image/x-icon';
                link.rel = 'shortcut icon';
                link.href = iconUrl;
                document.head.appendChild(link);
            } else {
                // Reset to default
                document.title = "Neonix's Notes";
                preview.style.display = 'none';
                
                const defaultIcon = document.querySelector("link[rel*='icon']");
                if (defaultIcon) {
                    defaultIcon.href = "https://gcdnb.pbrd.co/images/2tAx6LlPWqWu.png?o=1";
                }
            }
        }

        // ========================
        // WEATHER SYSTEM
        // ========================
        async function fetchWeather(lat, lon) {
            const weatherEl = document.getElementById('current-weather');
            const unit = settings.weatherUnit === 'celsius' ? 'celsius' : 'fahrenheit';
            
            try {
                const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code&temperature_unit=${unit}`);
                const data = await response.json();
                
                if (data && data.current) {
                    const temp = Math.round(data.current.temperature_2m);
                    const code = data.current.weather_code;
                    let emoji = "â˜€ï¸";
                    let status = "Clear";

                    if (code >= 1 && code <= 3) { emoji = "â›…"; status = "Partly Cloudy"; }
                    else if (code >= 45 && code <= 48) { emoji = "ðŸŒ«ï¸"; status = "Foggy"; }
                    else if (code >= 51 && code <= 67) { emoji = "ðŸŒ§ï¸"; status = "Rainy"; }
                    else if (code >= 71 && code <= 77) { emoji = "â„ï¸"; status = "Snowy"; }
                    else if (code >= 80 && code <= 82) { emoji = "ðŸŒ¦ï¸"; status = "Showers"; }
                    else if (code >= 95) { emoji = "â›ˆï¸"; status = "Stormy"; }

                    const unitSymbol = unit === 'celsius' ? 'Â°C' : 'Â°F';
                    weatherEl.innerText = `${emoji} ${status} ${temp}${unitSymbol}`;
                }
            } catch (err) {
                weatherEl.innerText = "Weather N/A";
            }
        }

        function initWeather() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (pos) => fetchWeather(pos.coords.latitude, pos.coords.longitude),
                    () => fetchWeather(52.52, 13.41)
                );
            } else {
                fetchWeather(52.52, 13.41);
            }
        }
        function applyHolidayTheme() {
            if (!settings.holidayThemes) return;
            
            const now = new Date();
            const month = now.getMonth() + 1;
            const day = now.getDate();
            const root = document.documentElement;
            const bubble = document.getElementById('holiday-bubble');
            const holidayText = document.getElementById('holiday-text');
            const holidayEmoji = document.getElementById('holiday-emoji');

            let holiday = null;
            if (month === 1 && day === 1) holiday = { name: "New Year's", emoji: "ðŸŽ†", primary: "#ffae00", neon: "#fff700", bg: "#0a0a00" };
            else if (month === 2 && day === 14) holiday = { name: "Valentine's", emoji: "ðŸ’–", primary: "#ff4d6d", neon: "#ff85a1", bg: "#1a0005" };
            else if (month === 3 && day === 17) holiday = { name: "St. Patrick's", emoji: "â˜˜ï¸", primary: "#2b9348", neon: "#55a630", bg: "#001a05" };
            else if (month === 10 && day === 31) holiday = { name: "Halloween", emoji: "ðŸŽƒ", primary: "#ff6d00", neon: "#ff9e00", bg: "#0f0500" };
            else if (month === 12 && (day >= 24 && day <= 25)) holiday = { name: "Christmas", emoji: "ðŸŽ„", primary: "#d90429", neon: "#008000", bg: "#0a140a" };

            if (holiday) {
                root.style.setProperty('--primary-blue', holiday.primary);
                root.style.setProperty('--neon-glow', holiday.neon);
                root.style.setProperty('--bg-dark', holiday.bg);
                holidayText.innerText = `Happy ${holiday.name}!`;
                holidayEmoji.innerText = holiday.emoji;
                setTimeout(() => bubble.style.display = 'flex', 2000);
            }
        }
        function saveSettings() {
            settings.theme = document.getElementById('theme-select').value;
            settings.animations = document.getElementById('animations-select').value;
            settings.background = document.getElementById('background-select').value;
            settings.weatherUnit = document.getElementById('weather-unit').value;
            settings.holidayThemes = document.getElementById('enable-holiday').checked;
            settings.bgAnimationSpeed = parseFloat(document.getElementById('bg-animation-speed').value);
            settings.bgOpacity = parseFloat(document.getElementById('bg-opacity').value);
            settings.cloakEnabled = document.getElementById('enable-cloak').checked;
            settings.cloakTitle = document.getElementById('cloak-title-input').value;
            settings.cloakIcon = document.getElementById('cloak-icon-url').value;
            
            localStorage.setItem('neonix-settings', JSON.stringify(settings));
            applyAllSettings();
        }

        function loadSettings() {
            // Theme
            document.getElementById('theme-select').value = settings.theme;
            applyTheme(settings.theme);
            
            // Animations
            document.getElementById('animations-select').value = settings.animations;
            document.getElementById('bg-animation-speed').value = settings.bgAnimationSpeed;
            document.getElementById('enable-holiday').checked = settings.holidayThemes;
            applyAnimations(settings.animations);
            
            // Background
            document.getElementById('background-select').value = settings.background;
            document.getElementById('bg-opacity').value = settings.bgOpacity;
            switchBackground(settings.background);
            
            // Weather
            document.getElementById('weather-unit').value = settings.weatherUnit;
            
            // Tab Cloaker
            document.getElementById('enable-cloak').checked = settings.cloakEnabled;
            document.getElementById('cloak-title-input').value = settings.cloakTitle;
            document.getElementById('cloak-icon-url').value = settings.cloakIcon;
            
            if (settings.cloakEnabled) {
                applyTabCloak(settings.cloakTitle, settings.cloakIcon);
            }
        }

        function applyAllSettings() {
            applyTheme(settings.theme);
            applyAnimations(settings.animations);
            switchBackground(settings.background);
            applyTabCloak(settings.cloakTitle, settings.cloakIcon);
            plane.speed = settings.bgAnimationSpeed;
            
            if (settings.holidayThemes) {
                applyHolidayTheme();
            }
        }

        function resetSettings() {
            settings = JSON.parse(JSON.stringify(defaultSettings));
            localStorage.setItem('neonix-settings', JSON.stringify(settings));
            // Update UI controls and apply the defaults
            loadSettings();
            applyAllSettings();
            // Close settings panel for a clear UX
            settingsVisible = false;
            if (settingsPanel) settingsPanel.style.display = 'none';
        }

        // ========================
        // EVENT LISTENERS
        // ========================
        document.getElementById('theme-select').addEventListener('change', function() {
            settings.theme = this.value;
            applyTheme(this.value);
        });

        document.getElementById('animations-select').addEventListener('change', function() {
            settings.animations = this.value;
            applyAnimations(this.value);
        });

        document.getElementById('bg-animation-speed').addEventListener('input', function() {
            settings.bgAnimationSpeed = parseFloat(this.value);
            plane.speed = settings.bgAnimationSpeed;
        });

        document.getElementById('background-select').addEventListener('change', function() {
            const customBg = document.getElementById('custom-bg-url');
            customBg.style.display = this.value === 'custom' ? 'flex' : 'none';
            settings.background = this.value;
        });

        document.getElementById('bg-opacity').addEventListener('input', function() {
            settings.bgOpacity = parseFloat(this.value);
            const activeBg = document.querySelector('canvas[style*="display: block"], #static-bg[style*="display: block"]');
            if (activeBg) {
                activeBg.style.opacity = settings.bgOpacity;
            }
        });

        document.getElementById('apply-bg').addEventListener('click', () => {
            settings.background = document.getElementById('background-select').value;
            settings.bgOpacity = parseFloat(document.getElementById('bg-opacity').value);
            switchBackground(settings.background);
        });

        document.getElementById('apply-cloak').addEventListener('click', () => {
            settings.cloakEnabled = document.getElementById('enable-cloak').checked;
            settings.cloakTitle = document.getElementById('cloak-title-input').value || "Neonix's Notes";
            settings.cloakIcon = document.getElementById('cloak-icon-url').value || "https://gcdnb.pbrd.co/images/2tAx6LlPWqWu.png?o=1";
            applyTabCloak(settings.cloakTitle, settings.cloakIcon);
        });

        document.getElementById('reset-cloak').addEventListener('click', () => {
            document.getElementById('enable-cloak').checked = false;
            document.getElementById('cloak-title-input').value = "Neonix's Notes";
            document.getElementById('cloak-icon-url').value = "https://gcdnb.pbrd.co/images/2tAx6LlPWqWu.png?o=1";
            settings.cloakEnabled = false;
            applyTabCloak("Neonix's Notes", "https://gcdnb.pbrd.co/images/2tAx6LlPWqWu.png?o=1");
        });

        document.getElementById('save-settings').addEventListener('click', saveSettings);
        document.getElementById('reset-settings').addEventListener('click', resetSettings);

        document.getElementById('weather-unit').addEventListener('change', function() {
            settings.weatherUnit = this.value;
            initWeather();
        });

        // ========================
        // THREE.JS BACKGROUND ENGINE
        // ========================
        class Plane {
            constructor() {
                this.uniforms = { time: { type: 'f', value: 0 } };
                this.mesh = this.createMesh();
                this.speed = settings.bgAnimationSpeed || 1;
            }
            createMesh() {
                return new THREE.Mesh(
                    new THREE.PlaneGeometry(256, 256, 256, 256),
                    new THREE.RawShaderMaterial({
                        uniforms: this.uniforms,
                        vertexShader: `
                            precision highp float;
                            attribute vec3 position;
                            uniform mat4 projectionMatrix;
                            uniform mat4 modelViewMatrix;
                            uniform float time;
                            varying vec3 vPosition;
                            mat4 rotateMatrixX(float radian) { return mat4(1.0, 0.0, 0.0, 0.0, 0.0, cos(radian), -sin(radian), 0.0, 0.0, sin(radian), cos(radian), 0.0, 0.0, 0.0, 0.0, 1.0); }
                            vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
                            vec4 mod289(vec4 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
                            vec4 permute(vec4 x) { return mod289(((x*34.0)+1.0)*x); }
                            vec4 taylorInvSqrt(vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }
                            vec3 fade(vec3 t) { return t*t*t*(t*(t*6.0-15.0)+10.0); }
                            float cnoise(vec3 P) {
                                vec3 Pi0 = floor(P); vec3 Pi1 = Pi0 + vec3(1.0);
                                Pi0 = mod289(Pi0); Pi1 = mod289(Pi1);
                                vec3 Pf0 = fract(P); vec3 Pf1 = Pf0 - vec3(1.0);
                                vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x); vec4 iy = vec4(Pi0.yy, Pi1.yy);
                                vec4 iz0 = Pi0.zzzz; vec4 iz1 = Pi1.zzzz;
                                vec4 ixy = permute(permute(ix) + iy);
                                vec4 ixy0 = permute(ixy + iz0); vec4 ixy1 = permute(ixy + iz1);
                                vec4 gx0 = ixy0 * (1.0 / 7.0); vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;
                                gx0 = fract(gx0); vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
                                vec4 sz0 = step(gz0, vec4(0.0)); gx0 -= sz0 * (step(0.0, gx0) - 0.5); gy0 -= sz0 * (step(0.0, gy0) - 0.5);
                                vec4 gx1 = ixy1 * (1.0 / 7.0); vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;
                                gx1 = fract(gx1); vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
                                vec4 sz1 = step(gz1, vec4(0.0)); gx1 -= sz1 * (step(0.0, gx1) - 0.5); gy1 -= sz1 * (step(0.0, gy1) - 0.5);
                                vec3 g000 = vec3(gx0.x,gy0.x,gz0.x); vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
                                vec3 g010 = vec3(gx0.z,gy0.z,gz0.z); vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
                                vec3 g001 = vec3(gx1.x,gy1.x,gz1.x); vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
                                vec3 g011 = vec3(gx1.z,gy1.z,gz1.z); vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);
                                vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
                                g000 *= norm0.x; g010 *= norm0.y; g100 *= norm0.z; g110 *= norm0.w;
                                vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
                                g001 *= norm1.x; g011 *= norm1.y; g101 *= norm1.z; g111 *= norm1.w;
                                float n000 = dot(g000, Pf0); float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
                                float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z)); float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
                                float n001 = dot(g001, vec3(Pf0.xy, Pf1.z)); float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
                                float n011 = dot(g011, vec3(Pf0.x, Pf1.yz)); float n111 = dot(g111, Pf1);
                                vec3 fade_xyz = fade(Pf0);
                                vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
                                vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
                                return 2.2 * mix(n_yz.x, n_yz.y, fade_xyz.x);
                            }
                            void main(void) {
                                vec3 updatePosition = (rotateMatrixX(radians(90.0)) * vec4(position, 1.0)).xyz;
                                float sin1 = sin(radians(updatePosition.x / 128.0 * 90.0));
                                vec3 noisePosition = updatePosition + vec3(0.0, 0.0, time * -30.0);
                                float noise1 = cnoise(noisePosition * 0.08);
                                float noise2 = cnoise(noisePosition * 0.06);
                                float noise3 = cnoise(noisePosition * 0.4);
                                vec3 lastPosition = updatePosition + vec3(0.0, noise1 * sin1 * 8.0 + noise2 * sin1 * 8.0 + noise3 * (abs(sin1) * 2.0 + 0.5) + pow(sin1, 2.0) * 40.0, 0.0);
                                vPosition = lastPosition;
                                gl_Position = projectionMatrix * modelViewMatrix * vec4(lastPosition, 1.0);
                            }
                        `,
                        fragmentShader: `
                            precision highp float;
                            varying vec3 vPosition;
                            void main(void) {
                                float opacity = (96.0 - length(vPosition)) / 256.0 * 0.6;
                                vec3 color = vec3(0.0, 0.48, 1.0); 
                                gl_FragColor = vec4(color, opacity);
                            }
                        `,
                        transparent: true
                    })
                );
            }
            render(delta) { this.uniforms.time.value += delta * this.speed; }
        }

        const hillCanvas = document.getElementById('canvas-webgl');
        const renderer = new THREE.WebGLRenderer({ antialias: true, canvas: hillCanvas, alpha: true });
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 10000);
        const clock = new THREE.Clock();
        const plane = new Plane();

        function initHills() {
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x000814, 1.0);
            camera.position.set(0, 16, 128);
            camera.lookAt(new THREE.Vector3(0, 28, 0));
            scene.add(plane.mesh);
        }

        function animateHills() {
            plane.render(clock.getDelta());
            renderer.render(scene, camera);
            requestAnimationFrame(animateHills);
        }

        // ========================
        // GLOBAL INITIALIZATION
        // ========================
        window.addEventListener('load', () => {
            const bar = document.getElementById('loader-bar');
            const screen = document.getElementById('loading-screen');
            
            initHills();
            animateHills();
            initParticles();
            
            // Load saved settings
            loadSettings();
            
            // Apply holiday theme if enabled
            if (settings.holidayThemes) {
                applyHolidayTheme();
            }
            
            updateDateTime();
            initWeather();

            let width = 0;
            const interval = setInterval(() => {
                width += Math.random() * 25;
                if (width >= 100) {
                    width = 100;
                    clearInterval(interval);
                    setTimeout(() => {
                        screen.style.opacity = '0';
                        screen.style.visibility = 'hidden';
                    }, 600);
                }
                bar.style.width = width + '%';
            }, 180);
        });

        // ========================
        // EXISTING FUNCTIONS
        // ========================
        function updateDateTime() {
            const dateEl = document.getElementById('current-date');
            const now = new Date();
            const options = { weekday: 'short', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' };
            dateEl.innerText = now.toLocaleString('en-US', options);
        }

        function showSection(id, element) {
            if (element && !element.classList.contains('folder-item')) {
                document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                element.classList.add('active');
            }
            document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function openLauncher(name, url) {
            document.getElementById('launcher-title').innerText = name;
            document.getElementById('launcher-btn').innerText = `Open ${name} in about:blank`;
            document.getElementById('launcher-btn').onclick = () => launchBlank(url);
            showSection('launcher-page');
        }

        // Games are opened in a separate tab via the nav link; no in-page games functions.

        function launchBlank(url) {
            var win = window.open('about:blank');
            if (win) {
                win.document.body.style.margin = '0';
                win.document.body.style.height = '100vh';
                win.document.body.style.overflow = 'hidden';
                var iframe = win.document.createElement('iframe');
                iframe.style.border = 'none';
                iframe.style.width = '100%';
                iframe.style.height = '100%';
                iframe.src = url;
                win.document.body.appendChild(iframe);
            }
        }

        let _gamesHtmlCache = null;
        async function openGames(element) {
            const iframe = document.getElementById('games-frame');
            const url = 'https://cdn.jsdelivr.net/gh/neonixgxmes/neonixgxmes.github.io@main/Games/games.html';

            if (!iframe) return;

            // Show games section immediately and display a loading placeholder
            showSection('games', element);
            iframe.srcdoc = '<div style="display:flex;align-items:center;justify-content:center;height:100%;color:#fff;background:#000">Loading gamesâ€¦</div>';

            try {
                // Use cached HTML if available
                let html = _gamesHtmlCache;
                if (!html) {
                    const res = await fetch(url);
                    if (!res.ok) throw new Error('Network response was not ok');
                    html = await res.text();
                    _gamesHtmlCache = html;
                }

                // Ensure relative URLs inside the fetched HTML resolve correctly by adding a base tag
                const baseHref = 'https://cdn.jsdelivr.net/gh/neonixgxmes/neonixgxmes.github.io@master/Games/';
                const wrapped = `<base href="${baseHref}">` + html;

                // Inject into iframe using srcdoc so we don't navigate away or open a new tab
                iframe.srcdoc = wrapped;
            } catch (err) {
                console.error('Failed to load Games HTML:', err);
                iframe.srcdoc = '<div style="display:flex;align-items:center;justify-content:center;height:100%;color:#fff;background:#000;padding:20px;text-align:center">Failed to load games. Please try again later.</div>';
            }
        }

        const input = document.getElementById('searchInput');
        input.onkeypress = (e) => {
            if(e.key === 'Enter' && input.value.trim()) {
                document.getElementById('searchBox').classList.add('searching');
                setTimeout(() => {
                    window.open(`https://sites.google.com/search/stealschools?query=${encodeURIComponent(input.value)}`);
                    document.getElementById('searchBox').classList.remove('searching');
                }, 800);
            }
        };

        window.onresize = () => {
            renderer.setSize(window.innerWidth, window.innerHeight);
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            
            if (particlesCanvas) {
                particlesCanvas.width = window.innerWidth;
                particlesCanvas.height = window.innerHeight;
            }
        };

        // ========================
        // ANNOUNCEMENT HANDLERS
        // ========================
        function showAnnouncement() {
            try {
                if (localStorage.getItem('neonix-announcement-dismissed')) return;
                const el = document.getElementById('announcement');
                if (!el) return;
                el.style.display = 'flex';
                setTimeout(() => el.classList.add('visible'), 20);
            } catch (e) { console.warn('showAnnouncement error', e); }
        }

        function closeAnnouncement() {
            try {
                const el = document.getElementById('announcement');
                if (!el) return;
                el.classList.remove('visible');
                setTimeout(() => el.style.display = 'none', 300);
                localStorage.setItem('neonix-announcement-dismissed', '1');
            } catch (e) { console.warn('closeAnnouncement error', e); }
        }

        (function attachClaimHandler(){
            const btn = document.getElementById('claim-og-btn');
            if (!btn) return;
            btn.addEventListener('click', () => {
                try {
                    const input = document.getElementById('cloak-title-input');
                    if (input) {
                        const trimmed = (input.value || '').trim();
                        const base = trimmed.replace(/^\(og\)\s*/i, '');
                        input.value = `(og) ${base || "Neonix's Notes"}`;
                        settings.cloakTitle = input.value;
                        localStorage.setItem('neonix-settings', JSON.stringify(settings));
                        applyTabCloak(settings.cloakTitle, settings.cloakIcon);
                    }
                } catch (e) { console.warn('claim-og error', e); }
                closeAnnouncement();
            });
        })();

        // Show announcement shortly after load
        window.addEventListener('load', () => setTimeout(showAnnouncement, 1200));

        // ========================
        // PROFILE HANDLERS
        // ========================
        const PROFILE_KEY = 'neonix-profile';
        const DEFAULT_AVATAR = 'https://static.vecteezy.com/system/resources/thumbnails/009/292/244/small/default-avatar-icon-of-social-media-user-vector.jpg';

        function loadProfile() {
            try {
                const raw = localStorage.getItem(PROFILE_KEY);
                const profile = raw ? JSON.parse(raw) : { signedIn:false, name:'Guest', email:'', avatar:DEFAULT_AVATAR, lastNameChange:0 };
                window._neonix_profile = profile;
                renderProfileUI();
            } catch (e) { console.warn('loadProfile error', e); window._neonix_profile = { signedIn:false, name:'Guest', email:'', avatar:DEFAULT_AVATAR, lastNameChange:0 }; }
        }

        function saveProfile() {
            try {
                if (!window._neonix_profile) return;
                localStorage.setItem(PROFILE_KEY, JSON.stringify(window._neonix_profile));
            } catch (e) { console.warn('saveProfile error', e); }
        }

        function renderProfileUI() {
            const p = window._neonix_profile || {};
            const avatarEls = [document.getElementById('profile-avatar'), document.getElementById('panel-avatar-preview')];
            avatarEls.forEach(el => { if (el) el.src = p.avatar || DEFAULT_AVATAR; });
            const nameEl = document.getElementById('panel-username'); if (nameEl) nameEl.innerText = p.name || 'Guest';
            const usernameInput = document.getElementById('username-input'); if (usernameInput) usernameInput.value = p.name || '';
            // Show/hide sign out depending on signedIn
            const signout = document.getElementById('signout-btn'); if (signout) signout.style.display = p.signedIn ? 'inline-block' : 'none';
        }

        function toggleProfilePanel() {
            const panel = document.getElementById('profile-panel');
            if (!panel) return;
            panel.classList.toggle('visible');
        }

        function decodeJwtResponse(token) {
            try {
                const base64Url = token.split('\.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
                return JSON.parse(jsonPayload);
            } catch (e) {
                console.warn('decodeJwtResponse failed', e);
                return null;
            }
        }

        function handleCredentialResponse(response) {
            try {
                const payload = decodeJwtResponse(response.credential);
                if (!payload) throw new Error('Invalid token payload');
                window._neonix_profile = window._neonix_profile || {};
                window._neonix_profile.signedIn = true;
                window._neonix_profile.email = payload.email || '';
                // Use name from payload unless user already has a custom name
                if (!window._neonix_profile.name || window._neonix_profile.name === 'Guest') {
                    window._neonix_profile.name = payload.name || (payload.email ? payload.email.split('@')[0] : 'User');
                    window._neonix_profile.lastNameChange = Date.now();
                }
                window._neonix_profile.avatar = payload.picture || window._neonix_profile.avatar || DEFAULT_AVATAR;
                saveProfile();
                renderProfileUI();
                applyTabCloak(window._neonix_profile.name, window._neonix_profile.avatar);
            } catch (e) {
                console.warn('handleCredentialResponse error', e);
            }
        }

        function initializeGoogleIdentity() {
            try {
                if (window.google && google.accounts && google.accounts.id) {
                    google.accounts.id.initialize({
                        client_id: '127008606660-vjpb07qo1e88sj5pvje5tv6rtk2llgt0.apps.googleusercontent.com',
                        callback: handleCredentialResponse
                    });
                    // Render the official Google Sign-In button into the profile panel
                    const gsiContainer = document.getElementById('gsi-button');
                    if (gsiContainer) {
                        google.accounts.id.renderButton(gsiContainer, { theme: 'outline', size: 'medium', width: 220 });
                    }
                }
            } catch (e) { console.warn('initializeGoogleIdentity error', e); }
        }

        function signInWithGoogle() {
            // Prefer Google Identity Services if available
            if (window.google && google.accounts && google.accounts.id) {
                try {
                    // Show the One Tap / Account chooser
                    google.accounts.id.prompt();
                    return;
                } catch (e) {
                    console.warn('google prompt failed', e);
                }
            }

            // Fallback to simulated prompt if GIS not available
            try {
                const email = prompt('Enter your Google email (simulation):');
                if (!email) return;
                const name = prompt('Enter your display name (simulation):', email.split('@')[0]) || email.split('@')[0];
                window._neonix_profile = window._neonix_profile || {};
                window._neonix_profile.signedIn = true;
                window._neonix_profile.email = email;
                if (!window._neonix_profile.name || window._neonix_profile.name === 'Guest') {
                    window._neonix_profile.name = name;
                    window._neonix_profile.lastNameChange = Date.now();
                }
                saveProfile();
                renderProfileUI();
                applyTabCloak(window._neonix_profile.name || '', window._neonix_profile.avatar || '');
            } catch (e) { console.warn('signIn error', e); }
        }

        // Try to initialize Google Identity when the script has loaded
        window.addEventListener('load', () => setTimeout(initializeGoogleIdentity, 500));

        function signOut() {
            try {
                window._neonix_profile = { signedIn:false, name:'Guest', email:'', avatar:DEFAULT_AVATAR, lastNameChange:0 };
                saveProfile();
                renderProfileUI();
                applyTabCloak("Neonix's Notes", 'https://gcdnb.pbrd.co/images/2tAx6LlPWqWu.png?o=1');
            } catch (e) { console.warn('signOut error', e); }
        }

        function canChangeName() {
            const p = window._neonix_profile || {};
            if (!p.lastNameChange) return true;
            const diff = Date.now() - p.lastNameChange;
            return diff >= (7 * 24 * 60 * 60 * 1000);
        }

        function handleUsernameSave() {
            const input = document.getElementById('username-input');
            if (!input) return;
            const desired = (input.value || '').trim();
            if (!desired) return;
            if (!canChangeName() && window._neonix_profile && window._neonix_profile.name !== desired) {
                alert('You can only change your username once every 7 days.');
                input.value = window._neonix_profile.name || '';
                return;
            }
            if (window._neonix_profile.name !== desired) {
                window._neonix_profile.name = desired;
                window._neonix_profile.lastNameChange = Date.now();
            }
            saveProfile();
            renderProfileUI();
            applyTabCloak(window._neonix_profile.name, window._neonix_profile.avatar);
        }

        function handleAvatarFile(file) {
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                const data = e.target.result;
                window._neonix_profile.avatar = data;
                saveProfile();
                renderProfileUI();
                applyTabCloak(window._neonix_profile.name, window._neonix_profile.avatar);
            };
            reader.readAsDataURL(file);
        }

        // Attach UI listeners
        (function attachProfileListeners(){
            const btn = document.getElementById('profile-button'); if (btn) btn.addEventListener('click', toggleProfilePanel);
            const signin = document.getElementById('google-signin'); if (signin) signin.addEventListener('click', signInWithGoogle);
            const signout = document.getElementById('signout-btn'); if (signout) signout.addEventListener('click', signOut);
            const closeBtn = document.getElementById('close-profile'); if (closeBtn) closeBtn.addEventListener('click', toggleProfilePanel);
            const saveBtn = document.getElementById('save-profile'); if (saveBtn) saveBtn.addEventListener('click', handleUsernameSave);
            const fileInput = document.getElementById('avatar-file'); if (fileInput) fileInput.addEventListener('change', (e) => handleAvatarFile(e.target.files[0]));
            const urlInput = document.getElementById('avatar-url'); if (urlInput) urlInput.addEventListener('change', (e) => { window._neonix_profile.avatar = e.target.value || DEFAULT_AVATAR; saveProfile(); renderProfileUI(); applyTabCloak(window._neonix_profile.name, window._neonix_profile.avatar); });
        })();

        // Initialize profile on load
        window.addEventListener('load', loadProfile);

        setInterval(updateDateTime, 1000);
        setInterval(initWeather, 600000);
    </script>
</body>
</html>